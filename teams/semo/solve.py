#!/usr/bin/python3.8
from Crypto.Cipher import AES
from typing import List
from collections import defaultdict
import json
from Crypto.Util.number import long_to_bytes, bytes_to_long

from pwn import *
nc_str = "nc 34.235.112.89 2601"
_, host, port = nc_str.split(" ")
p = remote(host, int(port))


key = bytes([0x24, 0xf6, 0x75, 0x43, 0x64, 0xb9, 0x54, 0xcf, 0xb3, 0x36, 0x71, 0xc8, 0x31, 0xda, 0x58,
            0x2e, 0xdb, 0x88, 0xb9, 0x42, 0x44, 0x23, 0x57, 0xd9, 0xc9, 0x5a, 0xe9, 0x4e, 0x9f, 0x8f, 0xe2, 0x0d])

iv = bytes([0xc6, 0xd3, 0x0c, 0x12, 0x4f, 0xbe, 0x47, 0xe8,
           0x6a, 0x02, 0xfc, 0x2a, 0x64, 0xb2, 0x30, 0xbf])

cipher = AES.new(key=key, iv=iv, mode=AES.MODE_CBC)

pkt = p.recvuntil("}")
decoded = json.loads(pkt)
print(decoded)
print(cipher.decrypt(bytes.fromhex(decoded["encoded"])))
