#!/usr/bin/env python3

from pwn import *
from decoder import DecoderIntf

context.arch = 'arm'

def conn():
    r = DecoderIntf('/dev/ttyACM0')

    return r


def main():
    r = conn()

    payload = bytes.fromhex('c120f8c2b5499467587aba26440a0689907cb1e199d4deb10267cb86887b24045797e65d9ff8b3f2079611c3e536a345a1d97128f2d62d232cd902e13ee9cd41438e20958dedf408909a7a5aa38e009f')
    data_own = bytes.fromhex('68f27d959ae383d4da2c3a9be0bed091945a90ba641714706202a6cf69691fc0')

    r.subscribe(data_own)
    print(r.decode(payload))

    bad_sub = bytes.fromhex('68f27d959ae383d4da2c3a9be0bed09195580ce827dc0ddf945c9734c3899691')
    r.subscribe(bad_sub)
    pirate_packet = bytes.fromhex('943c5718db83ba3d90713906d9bb42bef2fafec9552a0539b2da0dffc8e01df77f0f3d1ff22051bed28cf973d49f8332a36b91351252f3b1000b0aee0a304358fc82c735fa14bf1a4c752e47dbb55529')
    print(r.decode(pirate_packet))



if __name__ == "__main__":
    main()
