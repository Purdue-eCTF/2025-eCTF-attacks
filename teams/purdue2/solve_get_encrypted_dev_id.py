import struct
import hashlib
from ectf25.utils.decoder import DecoderIntf, DecoderError
import sys
pairs = [
    {'ct': 'ec14dacd47016296c474cc8dcfea358f',
        'pt': '59f01144e4415b1cdaa4c72a85c17374'},
    {'ct': 'f3acf2d09187f809c36b067ddb5f03ff',
        'pt': '1d7bca33e9eb7afa83e21d7bac10dd9d'},
    {'ct': 'b72729a79c2dd9ef9a2ddc2cf28ead16',
        'pt': 'ec92c7f4428134d785d21e0d060d57b9'},
    {'ct': '55acc0340ac0370d358eada205d375a7',
        'pt': '52b51d77c749d403106ff7ec72037868'},
    {'ct': '865a505011b9e7689597cb2ad9282c0b',
        'pt': '0aa8ce4a34f74079aa3c3686bd8e3e49'},
    {'ct': 'a0f42dde4131e36cb3f3f7d1e3104ec2',
        'pt': 'f6dd997e4aca89a61e52ddc3217dd7ad'},
    {'ct': '5c817aea3f0c2ab3079d1c947fe3a726',
        'pt': 'e79c4ffe682f1aef0a9240e4acbca035'},
    {'ct': 'ec3cccb92eb577f8676bc56e5b906268',
        'pt': 'f45dc7f636b76aa3c586f80ce8cf38f0'},
    {'ct': 'c006d26eb57b3f0465c5fda0d53ffcaf',
        'pt': '422bfe0afc9fadefc6a3983a79b0b5aa'},
    {'ct': 'ad3c73657399d65363b3ea0ca29ac2f7',
        'pt': 'c9156434e134b0f646b89a8c5ffe3d46'},
    {'ct': 'f11ec46d04377addc8ff6e9668baffc1',
        'pt': 'dde6e82535439be91ba830075d28da5d'},
    {'ct': '33c5a0544d28070195437bc94bacd30c',
        'pt': 'e925c509719a399dbaac2cfe9981de37'},
    {'ct': '4379269d045c9a88a363eda9c71faebc',
        'pt': '89cfa9b57f26ff7ba81bb11fe2261104'},
    {'ct': '67380d53349ab69a2e500a246624b2d8',
        'pt': '02953a32dfef4cd3408a747e8b755b61'},
    {'ct': 'a8c9d9a6aa29efc65945b529d5eb2bea',
        'pt': '0679e08db3393214ffedc60238063b73'},
    {'ct': 'ac250319c6ff9101e622075566984bf8',
        'pt': '7247b2eeeea672d99ddb90928794585b'},
    {'ct': 'd81b517a9b60d1cc841451c5d90a28d0',
        'pt': '8d3788eb8a2c32b68143ec8a8c60711f'},
    {'ct': '276b6b7fffea91a3988c2dddd2fe0194',
        'pt': 'eeddb119da84ee1b17ee2b27c0f6bbf1'},
    {'ct': '3375b24505d577c3284e24a9729c2e88',
        'pt': '96db581e90ead195617c60ad66282d9b'},
    {'ct': 'de4c749f5d21a4f1f3e5a51e4f7f28cd',
        'pt': '3f321c4a5559817c1509ba5e59e841cb'},
    {'ct': 'e29dc83269521df03a6fe681ff942fbb',
        'pt': '8e0894520642e47d89ab6d7641c9cfa7'},
    {'ct': 'b910ef3bc50d98611768d323a5de06f2',
        'pt': 'e835687cc31fec945471d1d7e0ec4d0a'},
    {'ct': '4cb3586c82c1b533f31325fff621d9b2',
        'pt': '34b9e7a8e9ffdb8fc3db54765667de05'},
    {'ct': '1aabb67996dc7146b85177975043890b',
        'pt': 'e698267f7897a43c4537a4c1ac206071'},
    {'ct': 'fc5c08972f05374c677c6d349887b919',
        'pt': 'bc4e6c7758e84eb8e7211f6836a219ed'},
    {'ct': '16128fe32d2eedadfeeede3f683c6966',
        'pt': '0bda792428fc03ee6faea04cfab1e5a7'},
    {'ct': 'a1869ab05d3aa0fb7661611ba42f952c',
        'pt': 'e6f8d4f806dda79550a6ca299632b679'},
    {'ct': '7391873fd7fb9f00715f9ad5f4ad86ab',
        'pt': 'e4c772d5bc1f639964b612b2d51e5634'},
    {'ct': '4e9b9141c9d9c08c7d79d3e58b8026bf',
        'pt': 'cd0f1b27984f2e21ba464bb59e17d845'},
    {'ct': '904f0af0a63c624346ab1261d913e558',
        'pt': '76a46aa2f7386fbd88e96a0b89c23a54'},
    {'ct': '5579750f1a68a3239852eef4510fdcd2',
        'pt': 'be681b6c98fa8f8197b0a45ddb9113d1'},
    {'ct': '0b795968112c12d86bbf803993d05d14',
        'pt': '68378eb1e9a40b418ab5b711b9e0b749'},
    {'ct': 'c26b6d259c62a854937a7646e77ec7c2',
        'pt': '25c9aeeac08722be6804df1141a80986'},
    {'ct': '8f954d7eb54181ab71cb1e461f36790d',
        'pt': 'a239f6e48d1cb6b4c38289ffb775d707'},
    {'ct': '08651570f8da15a1da4d48a8e9eba78c',
        'pt': '82232a68a4318f77184d3d349bd420e2'},
    {'ct': '453e8771d8db2538b7dacbf86976f4ef',
        'pt': '6794ca372e8b08dae1325aa4258d755f'},
    {'ct': 'cdc829a35b4dabcff8fd9bf37b1305d4',
        'pt': '5f97d0d7e0616344a483c24a3f59eda3'},
    {'ct': '2bcec526f0f4e63868abe1bcb6189b0d',
        'pt': '23c15fdec7e96bd91176860fb6c36aa5'},
    {'ct': '923ecf2a27dab8c80d9c117faf34a7e7',
        'pt': '43631c4ab3e5930e284b8193f1650f0c'},
    {'ct': '77539a411c113eab6063fe80d47dff93',
        'pt': '4eb3ad600114b32299b360ad98e3f96c'},
    {'ct': 'e713950acdf4dc931484e163a8b7463d',
        'pt': '628351dd6843d9b3f5cae90c92946160'},
    {'ct': 'd6c1671c310a0750d9d557fcb624d660',
        'pt': '403b1d44057082f3e83d41610866f7d9'},
    {'ct': '0f3128e48d4cbac5b5a4cb088b9b2047',
        'pt': '6b76593dcb90d8a83d0f14b896b65408'},
    {'ct': '822ed084baaf7f18d19fa4d928f567d0',
        'pt': '0da4fa54dd6ea9e46412d1e63cef4aa9'},
    {'ct': 'a7f819c0a8a80af17ddd10b162713a22',
        'pt': '88aa68da3e7877b4ba86a8c464ffe30d'},
    {'ct': '9ca7f567f8c14053db84c0ffe3b9a146',
        'pt': '44ac3c0cff582af8b8a1a862bea45946'},
    {'ct': '724d5c9006df25949c3940fe606b2420',
        'pt': 'ed5a30c3d854271aea86b93a559b9a30'},
    {'ct': '4706d357ad92840ff349786d0b05eabb',
        'pt': 'b78b3d8d1a4a7c91645c4ee345776d54'},
    {'ct': '3bf1658eb627c1ef4d9deab773665c3a',
        'pt': 'dfe25edc37a4538623da98d0635472b3'},
    {'ct': 'b281fa2d9c6ed47e778d22e380b26914',
        'pt': '9b7393e0f2fe3d160f9c4089ba89a0d9'},
    {'ct': '312f707487389e03165381dee417d052',
        'pt': '347d8c3ed6efaab060540e8989c4b931'},
    {'ct': '9e216faaa32909a5799bcfded75ac9ba',
        'pt': 'c02ef7ae218cf3c78bdbdb538304ea1b'},
    {'ct': '9f951ecf35df112ea503a48b3aa1a009',
        'pt': '9b95e6ecc42209f2a035b1a16802e6dc'},
    {'ct': '31c90578b1e4aae7b9fa70f6369c9657',
        'pt': 'aba20cda5ec9465fe4987d1c7d48474e'},
    {'ct': '01feef4e2b0fe54afd57bc4b23d637c5',
     'pt': '7b8821d665a5314a78971436a6900736'}]

recorded = [
    {"channel": 1, "timestamp": 1556747850343614, "encoded": "2d7379d6ec11cf3d9387322c5fb74017bab2f7f4d277dd90471a0ff69d57e82bdb5002986ef0fba2b392b7ed77b96c111821794370d8ed7fdf50da0b7085123b32efaf6421dbb7e14e17f1d4afc6f52f4c385e5508e59106322cdb0762dc18f1"},
    {"channel": 1, "timestamp": 1556747850845200, "encoded": "7c4c9028861daf8420f9ea399434bb8907693ebea710007b4c850397d908a8a363df6ada10b081bc6fbb1514f75361c9b6d56332c465bb8b02fe3e035a268bf3082f3c557779a52463a0fec3f08786bfdc6d6835af80fec1d40bf87505e8b833"},
    {"channel": 1, "timestamp": 1556747851346808, "encoded": "66f3f3e98bdba3a94dc26de442bb0ad3d87eb6ddb1b30e0bdff2927153f2e6fcf4cac4d51ed471c0ef05c37f03613ed28e000564b68e194d93410e124b6e39da6196617191e46dfd316f76f24273df42583fe74f52d834a009c5c61e30feaff9"},
    {"channel": 1, "timestamp": 1556747851847035, "encoded": "2b82485bc434b7a8a4b6dfc56911a7c48c9ea890a1980b51fb33c2fbeedd3408d13a901507d29cf1b822b3b54cc92f9981328e5459874c97e68a51244246bd43d8a74e8e2a66100d5220a6404a5590476d0d2eefed3647150705606b6f6f9996"},
    {"channel": 1, "timestamp": 1556747852348661, "encoded": "18885238cb053d326c7c8a728a35e589f837aca242a5dc1aead0d3194bdb7b3f5a5f182e6a8ae57c1db5bde71a2b65d91b20a4eec318308328c51a45343add349a84f18252a75c9ade5854d11fe03959af81a8b4573b3c881cda406a06e8ca21"},
    {"channel": 1, "timestamp": 1556747852850269, "encoded": "02bbf9cdcf7ce887d45f3c27d0ef6d49b77faefb609aebc288be31ae0aaabad535b34f1098f6fed17f1a26d59190d4c843707a37e0d6266d176f11198bd4119d860101993bd981f4b423795a9cd7bfa49991c3c34a2968041f291e3d0b06d0d9"},
    {"channel": 1, "timestamp": 1556747853350913, "encoded": "7be86031f26ab93ca18cddbf5c6caab544dca85faa691f43d1d522c4d02d887fdd75a4a860b750d387931a12740accbdf92c1ea1535206e0e144f155bc9429e2d3435f17cf1c0411441dcb2fd3fcb8bb603886acf3dc92ed89b8c3539225ba4d"},
    {"channel": 1, "timestamp": 1556747853851577, "encoded": "0648eb8e4bc4707ca7c33ee29eca0ef165b4630a47db97bcb7f519fef578c29e5ee1596a14bd91bfa86be93dcc30bf6ea252085b7f4af746486a8846dfb38624d0bbd27047828d56645e40d729a561db79d97116ccb6a0fdffd8845c3896fefb"},
    {"channel": 1, "timestamp": 1556747854353132, "encoded": "3785b4f9500b793648ad4e36e0bd43cf938753205ea609930e66b969b5afc899714a69050751fde82b5f3d40bdac44b827eb4ed617da474da4e490d547f45d8fc38d2f0655ac3ffc67e80262147bdf5e4a4e8f9a7f1dbea458955382d2864b04"},
    {"channel": 1, "timestamp": 1556747854853705, "encoded": "e9e53b5daefec7493cf1b2ec7178129282152f3204d124b6d44cf7fc30ab58cd1a77a45d74b92b37d281b8bc840bf8a57d652587cf43f93852cb622bb18b00731179cbfb6183235409f88168ae0e574cdcb77d542c2450f7870422b2ba82d0b4"},
    {"channel": 1, "timestamp": 1556747855355333, "encoded": "a07dd721d9ce391b94208cd08fdc808213db9b5fbdd12317dd723d0a4a1269a21fdde2e2913d511beb86f406a54e145016e81dee285f6fe5536708105d5394cc493432300ff204f31e574592e06892e4dfa202df6143235dc3a9d1c62205b9c9"},
    {"channel": 1, "timestamp": 1556747855856932, "encoded": "81caf5fa1a5b66c2a35721f10b9dce4c662c85f9e6eed01b3d168789111e7a1216b81b5a3017a57c11a748b21e5bda1eb98a9335639e9dc32a0635e423cadabff5316aa44c1270a7a1ad67f3321e25111f4d714a8c91b2bd80714620f8a6062d"},
    {"channel": 1, "timestamp": 1556747856358584, "encoded": "2e6e1f7b6fa322d9cdcdc00002c88dfee64eba7777bbfbf607463216cddca043adebd3ef6bb1d5c1c71484e60476a5fd7d375b594f3273484d728d5d7ce976ff0071fc6c8b1ae55d986839cd0441391ddee0e9edc4a682e57f1c5de81b4cf3fd"},
    {"channel": 1, "timestamp": 1556747856860156, "encoded": "0bc749bb6f890437bbbb5522a4be8ced8eddeb07abeb78015ce6a7aeddaaee49bd401091c133e60197569cf6ab1a351cc593d1461ae18f0d5e499f0fbb59576c0b59c9b087672735c62d43297f393ccbbfd827a40a89b0f2ed5e0b6685e809af"},
    {"channel": 1, "timestamp": 1556747857361776, "encoded": "dd638f4557c59150c621e14a2024554ce270da9b2edbfe71bff11212482637a087ff0ccf2d24849ed15d5ee7929004ed812f385716794ebe7aa8d4e6a9cdaa7570c1adea5763b190ee51a38f386e3f66228cf7912a3cd2ac44cc0eefc19a70f7"},
    {"channel": 1, "timestamp": 1556747857863399, "encoded": "96c6396e5ff1256eac958babf4735e17d6d855e61a5c368032f4ad43a4fa843226bc075e9e09a104cf7aad86a06cdda5ab1faafc84cb0625b43a97dda98ca0e5de6397335e8e28d9dd74aefcebf6411be98fc9058af5ed27f99dbe4c66750663"},
    {"channel": 1, "timestamp": 1556747858365045, "encoded": "38db63bf7efb99b369bd125b633bda89a7937da1d6e80d60ed093009c0a47189eda53eff05cda0275e7ce1482a54b0fd757cf7d47ad1f27b8ab018ed874f57fce475c278fa35ed010524d06ab9cfdfd4c165a194e9a3ac11770b9cb388feea34"},
    {"channel": 1, "timestamp": 1556747858865727, "encoded": "b46e4e7c4b20bc08236585af132be6ca2d425e8357566ef59d0faa625686c2bbc0e7b9684d5ccd2c99214de49e8735c181d5b1435f6f8cf30c4c7f6510994e4556cb5ccb5d783627471076e60436c8c2fa702ae5e235a32bf467a49ffa246e63"},
    {"channel": 1, "timestamp": 1556747859367343, "encoded": "861578886301d59b734502ca32cb7c84091cd85a7d0e189933139f70ac94a0c9593cfd1ce98f72fa75d74e4dd5be9dd7ee95a30429bce5730ce5c64455e82f7786764c049f5a92be145c995422947c47b44d524fd40ccff49f43bc299c381235"},
    {"channel": 1, "timestamp": 1556747859868976, "encoded": "f0c620b91467f70c1f0d02110f6180571c9417a1ba109b7f7717fea63c731e3ebe9e8eadaa81f45ede005cc8d7e53a9421d531e7d960d16e0f799b823d2adb9adb336c0f301d5b9ca7e7541a52e05a2d920476e6c31356cacde2ce83faade366"},
    {"channel": 1, "timestamp": 1556747860370636, "encoded": "659f7e85255194c8b166d895b22abb4f3e6b2c5c4194577cfbbc15d5ca8806651dd72f966d50a9b1711c89946550d5d0e89e2d19609b9357cc2367e261126fed164309f41526d22da4dac7934bbd4fc3c2e62ec1062a2259d67fb204aa7ea4ad"},
    {"channel": 1, "timestamp": 1556747860872241, "encoded": "59fc6d1ebf60700b219bac4b5b96598810c7a30e8e10eac08d7307a53709926bfecb6b513d397ee177d60a039b7de7cc51c05d3666a5b924b041c182b06cc3ea7b42ea5af8ec07b76d85da840f896a5051d4621bed654aa88a720983e9965e19"},
    {"channel": 1, "timestamp": 1556747861372903, "encoded": "9a91efefb2b7b63e887fd5c64aacba20deb0336bfc6ad338642a28629805ae109dd811ffbc7635a3120eaff2ca23bea942679fd09ac9f34e02ff8a728496716c65298d3cbf850c83ea618618cb8596ef4efb6021d5ca378a31f64d78206b8900"},
    {"channel": 1, "timestamp": 1556747861873087, "encoded": "fe4dd5dbc3826a001d342b80aac57d61b4bd06652b5fb89bf36e0d64acafe144c4616009a8a64beda2190a6986a3b8b7bcc120deac78e9397d02e09bd1160cffcfc5d4cd921963d9ba802df784fa61f408f93510bcf46478de44ca5358546592"},
    {"channel": 1, "timestamp": 1556747862374660, "encoded": "0a72e2cf18f33e46b90d2c1dafeef23625714e6f0df1335725021ef7c4042e42fdcc75f3eff31bb0d46989eb448af6b959e3a45ea8ef5cc5c8630b5dd90eeea0f5fee9e9ba617206883cdbfa902ce5ac2a704029a5991fd0329ff23d48483220"},
    {"channel": 1, "timestamp": 1556747862876216, "encoded": "59296dcc9a44c3d157811562c4e338756b26bdbf9b729f4f50f9397d35abf624664f0cea7586c952420fc8ae80f81cd66b0921171a13330f3297bc6946bf707712055769574c8f9397d0fb45a0f1fffbedf2c49bd2a33cc997970542a94ea717"},
    {"channel": 1, "timestamp": 1556747863377834, "encoded": "3787482220720a7357ed877b6f8cebe857450db51b66cfaa0a3456bc49df1afa8a72b931a2385f1d24bbbb9073ee5958edcf3d00b5bd33d9dfc71121464bf4e2b89cc502310a2626be77ce6bfacb68ecae907881a00eb788003a5edfabcf31e5"},
    {"channel": 1, "timestamp": 1556747863878481, "encoded": "35fcc141a77ccdec398912de82bf4622c2ae16b44535be1a2648a5614230c0c39c8e7f136e32d72d0584a063d054ccd697dc3f74ff20a7e8e78bf2169943278f4c38e269edf7b47f62a9e04615c17f11f960a2e280ce0d5993bf8bbba9b416b1"},
    {"channel": 1, "timestamp": 1556747864380046, "encoded": "835c87cc95220fbd82591ff7e8835272adce13a59624257d1cdb474a93e7434d86e05885af47f0b66ecd34f0168f6b6ad8334a2b504f883f0b0657053576032d2a6aabf0a0213013ab56899abd9674287530ac8cfa6f708123bb954ccf9c36e2"},
    {"channel": 1, "timestamp": 1556747864880687, "encoded": "841d3711071d10d4a8677386e1a12ef115e814d6a0c0f179bd734215d8a5f74711eb455b05ab6b36f2a7fd495f7d1c7fdf854563d36fc141c60143cacb36d0c8299414349267e7c9124b1e9f4a3c113b0e5795f3184dffebdab25324b36867b2"},
    {"channel": 1, "timestamp": 1556747865382252, "encoded": "f323a049ad883b6304126d82227432df27f7f69fa29873e4b5824c28ac394bdad438e42fa177ac44a87894468e9686f228b4b6c01cece4e148a68ff26c19b8b137a98a356cec0e81a2bbb719e3d2482513c5dddd4ec54230e5ec5b827ade01a5"},
    {"channel": 1, "timestamp": 1556747865883846, "encoded": "96bc5dc68a655e3c7e2cfd644ec792204c87162e118c861a4bf7a94d5f9ee70fa5780254a16af51c3dcaef59c498bf7822ff35c9250cf0631fbd4d79d55244b9b0c280e746032e2b05348145c38e5e5b275fd600128931c5e1a61805c5364085"},
    {"channel": 1, "timestamp": 1556747866385411, "encoded": "bac8c129bf60e5580b2e5433676244828255496ec0aea6bd1c2b7773b4ed7fca88fbc7bdf3bc6ba24e3741b08ef2723c57fa112c97187ba7da873cbc673a63ffee6c6df854bbef90bec2243633dc1b321d2d5750cdfd8bde6ca81e91bdf2d479"},
    {"channel": 1, "timestamp": 1556747866887034, "encoded": "68ff4fd91cf244f84b1dd81333fa8dbb9b305e80c9719ff16413644f11d5f2d441e01b26d34d86d75653606c920f1d1ee483c683d320d5882225d26073aa95e14a55090cec3f86f52e296f3493161a4454fd1c19652bf9287157d064a3b0e75f"},
    {"channel": 1, "timestamp": 1556747867387215, "encoded": "c40e1a67e769f66c746f2507698155d7ed40f0027c887f02bbacd4f78778a971bc5cd34e2ade909db0a6ae51602b0a06e173b355ced3653eb36de54441f5412fa14630638c89eb2a7045bd3f2f2ad1ced74c131e387ce154277a973b31e0286a"},
    {"channel": 1, "timestamp": 1556747867887911, "encoded": "492e8f0b16d945f3ae807a67754fd8a9df674adc22a43a42aeae72adb09abe833ff5870f74fe489100b05972a1865880544851618437fa01f7d2f96b9efb16007611ed56e4aa0a12abf178fc5e1ad9c5331c74751ad50f13ec4ea8927c36d223"},
    {"channel": 1, "timestamp": 1556747868388707, "encoded": "50cc10eee8bacb2bcff16917f312995527bc6388410f4347555c9ade3b84b01e236f2942520cb6bd2512e1ecdc88b31220a553f3c2b00fad1dbbc8803277938a6143ec8ddd8a040374e63a1a97db218626caf49e3e5c905b6a29762ad0ad277d"},
    {"channel": 1, "timestamp": 1556747868890309, "encoded": "e44afbaf5bffbda26d3f2ca8c5ad9d0c93e1f45e9a27846713ecbd993d34eebd451b4e20b37e626ee2e4712821221e793049af5b5dab6e86a0723c36c4fc6f7aec2638e6a3f98d12892bb33e3265d38d41c1a2057a07355b1540a2557935c89d"},
    {"channel": 1, "timestamp": 1556747869391908, "encoded": "2020a732f0109ed9f97a0b52412407b761d4b6226c19cfad3b490992a313e1dbc03a79de391e7767e38b271c29fada0833d5b3418700b2cffdb1e4d0ea46fca3fc666e389f99fce22f1f0db977165fc36f30d4055062ba05e9a4aa5f81893621"},
    {"channel": 1, "timestamp": 1556747869893604, "encoded": "00cb31a5b237894e4dd980789b34eaaef31dad47a6b9f4b174bceac0f593573db8d8e5c5454a5e9f41c987f56e2d7218c1ad715c40ce989c79313075fdae689be3d8d2d634be98cc6cec606f192c9fc1d03422e6f994a889505c5a9cf8e87ee3"},
    {"channel": 1, "timestamp": 1556747870395231, "encoded": "8e3f100240310c5faf0fe97151b99b50117923cb4fce73e57dcf0265d84ec6ec4ee894d7b604469777319bdc862de232ecf80938f496d4b6a1cfad340426d865d5065945b3338722ed026c621b517649881a066e1d9cad1c2859fc9394a3d9f2"},
    {"channel": 1, "timestamp": 1556747870895885, "encoded": "4eb9f8be967d6c3a2b3f4e4d9308a09510ab8aa3664a346f99db1e04e2d8cccf01c7dd83f518c4fc4a439719fe6a07f4c4e29b5bfb4098e54d5cbad098037978ed687754e1c73b511b10a7434cf0d395b26ee5a4de6b37754a3a3b583cd830f5"},
    {"channel": 1, "timestamp": 1556747871396574, "encoded": "0e7e5b63d0ba2f96ec6e9433e52c6c9b143764a3c9b737ad04ab5bdea4e06d88fd61b80b1c3858350a058164ba6ec3249c098a54bf828ca62a5ec85a46a2952403ffe88db7afffe20986d263497f0d32e0fdf6e12d93fe21b938bb5b3098bf3d"},
    {"channel": 1, "timestamp": 1556747871896766, "encoded": "15fe8ac6898410f4fb909164b55216ccf1e4ab90a938a45bc60eb111b2f926573737781dd50373290e3686b01d9a01023195bf1ea55cb57f62465852af2967a6cf8a8f44729122735db0d882caf16b795d9c89d0c2f8ace0f4016eee09af8b56"},
    {"channel": 1, "timestamp": 1556747872398364, "encoded": "3c8b330f26f8973749feafbf8276fdc8da4777ed478a99ddd3bd9e6512f3acab48911d4ada75abd5b0b5a64bccfe0a60e21df9a0bfbba03fb89682f8a0ee866f66375f199109fb6d7506a298be76fa50b0dd671434d1c0441b10bbb886f05984"},
    {"channel": 1, "timestamp": 1556747872899019, "encoded": "e0044311d5d38b646b0b0dc85acba2dc750cc458348c132bb897143ae43f71dc1fa9d2562346669db0f8c9ad87af5d771b3242ec64bdd0fc4d7be28d6bd18fb26a7a4d45e97a8f0e522b0db661668a204fc21956fb386089241a1ee68fb55d29"},
    {"channel": 1, "timestamp": 1556747873400695, "encoded": "4a826da098f4b32fee3021f6522196b616916841bf699aa5ba2f1fc17a442d5da9b0dec8e00dd4c4524db5089f19b773aa06de7fdb9fae7511a12489aaac2bf99c9f7ba3dc5456f12fcc64f04de1155d35273189c74ff3265a35bb52e60afce5"},
    {"channel": 1, "timestamp": 1556747873902347, "encoded": "9e9d64a328fba057124a0479b40e55ce68fa44d5ff8083fcc87d7e0ec68a3303ea9c83e20540bb007fd6e88f7497f0d88ea55780beb852194cd6df6e3880c7d97ea579043ae62cd6e252027a5520a2d058539c7cff2bd93b042bfeac655258d7"},
    {"channel": 1, "timestamp": 1556747874403002, "encoded": "27923488837ddc0622526b39452165cfce2877f4bf095afa492a3df5069fd63a2f7acbf2c31f2b440120bead14ff4ac87a5a03f7365d9e085fdf65a472495bebe1e38b0f61e5d47fa513c61e238d2b5a9e9643272077c5cabdddac05a1e6403a"},
    {"channel": 1, "timestamp": 1556747874904656, "encoded": "fa5da37c52ec9efb2e6abb652413a11fc1e4d061acc96cea54b2fed7bb658819c34b05ad2babee0bb352afd74d855de752a52d79f9c463e5d5f644534b11b87348560c96f448bd14f875d0538aa023e988e990160978ebf67629de8cd4a56d5f"},
    {"channel": 1, "timestamp": 1556747875406285, "encoded": "3ecc02d2582ae47f3d3335bf119bf2e6ee3b3b73a8d91ef44effc9cabae911307f21cd4b4567d57ecb8c147943b9e7906558983fcca5e45c3252f3b19f2b06a85fcf60bffce3463d4dbc110d722f1324a14991204ab50cde675e14352e2c9bb0"},
    {"channel": 1, "timestamp": 1556747875906974, "encoded": "cfba597298e5cbe039a3b7b6f5fda56e101dc81f6921c87b6bb35f11600d1d533e6b028ba108d58e52e4cd51d342dee65fac0d14af24c1a9e6c9452b592ed571ab7407fb203124a545edd71f725c86a0f834e865479ba1761c1a42e05d465d1c"},
    {"channel": 1, "timestamp": 1556747876407660, "encoded": "2c47445ee8f38e7d59e7a424b80b2a92ffba39967796f258a79739b0766d1407d0a0c8f9f94d5f2047c0007dad63f6bc3d40aa5f9c6938f937abb6f33dc83c51b11bec1541b40bc75bb9a4b4a0004d20c7f49429e70c95cc7123c18d9193ba50"},
    {"channel": 1, "timestamp": 1556747876909241, "encoded": "6a56b62bb41e91293e16f180e9264961d799b822ebe60593db671bfc7d6783bcf22302d2123540d0c44219c02b89dfe87c45f1ea1edf9c716d2f7325d59573d7e6fb08f40d967c36c8a06aa4ef4dc0b1e5c2ba444f952b66626bcc8d16be996b"},
    {"channel": 1, "timestamp": 1556747877410863, "encoded": "bd6e106c04a21f09e609e79e8c07dabea9ee9921db7c8b8129ab5193f552e2342f906651d5e8cf59abc47ba673a44f3e097759f3027aee35cc6801bbe0fc2d59c0b7d48bd46873c3ee62936754ada813fd6512bbbb550e5f291a273c29faafc0"},
    {"channel": 1, "timestamp": 1556747877911543, "encoded": "b5f8ca9abef43c3c80a6190047132f1eab5cafb33f7582c56e4868a617e0b9f17a307a7f11686f2b26374a8fee822b4c22461135b989114ea716cf7fbcc4f3fd050fdb4ce9c9b4f4f939ae8ca4aeeb2153ec1dd64bfb0f6cfcf410ec22d137b0"},
    {"channel": 1, "timestamp": 1556747878412190, "encoded": "f8dc3911f8873ff207b3d45b23b2cbec87c457134557b9b42341a1734005b394cf46196114d5bc27b4da3974fa361d0a203bdeec6cff33fb803b1b2ec060de1074f5844cb1b573fea6fb04e36a86a20287827abc4a8f05da6c477adac3c62fe6"},
    {"channel": 1, "timestamp": 1556747878913061, "encoded": "1771616f553adf3c39155da486215c2ea3c39dd1ada87880dabb2bca5df04f182a200544851c1dcbfbdf66f65964b33f00a48bb8ee980f8d416efe6173b024c2a4af5ef47c38573e51ec3a074b49bcdf126fbebbab16262e510999c13a5c26be"},
    {"channel": 1, "timestamp": 1556747879414707, "encoded": "0ca2743fcaf67ca32bfda5684c306afb8661ec406e750e6adda423cc8aee85fdeb520c607c5d6453e7bb85c2eb2e5a223e155c52b3f8f171e500f5c44fa727a628531034ea1591d7daccd718235f1538930f90cd4e8b0d47cc4ad452c9b658b8"},
    {"channel": 1, "timestamp": 1556747879915395, "encoded": "222247e6a40761232287d05c5c74d92820ac6a15cbee3c5b68d57711530a2c66115da8ba3143b511f2e3c8aa38cde24cca3f88958c6450d112e7215b292aae5d42c93fafb2db67c23a7c4d7beeca93dd5d40d728acb4b8ef815566165c6a1ac5"},
    {"channel": 1, "timestamp": 1556747880417029, "encoded": "ac50127a33ead7f3deb91abdb54a6860fa72bccb7ec8401644713992cd40be78c309f75dac6fd5f0e8907cc4250446b6bd42615e37960acadd9842edff3e6de0060c58949b215cca0f6aa1002679a2173c6df7d008a47f22e482782abf45fb4f"},
    {"channel": 1, "timestamp": 1556747880917775, "encoded": "1bdb53b01e143568b9325810a25173b427993d057caca673e4996cdc47b64cd0cdd3924ca6ef9040ff06621cff1edaa53ab431646fa6454c298dcb9a7a695d3eacf88e11b4f4d6853ab8dc3f11b0aeb38ee837749d5e2da6df2ffa03e8aef674"},
    {"channel": 1, "timestamp": 1556747881419416, "encoded": "fe05059b50a62bb42780980dcd55ee71883b287e837ca7ed03d3e677cd60aca6e9806c00a0d876c8871c1b12fafd8007b5b6abdd66b27d4908443f4f2f92a152e91bd0b69af3430896018cdab7d815274c70e0a26b9cdfd13da4e3d0a8ef06b5"},
    {"channel": 1, "timestamp": 1556747881919880, "encoded": "ce5177e8db612c405c946a16d1577a1fab935d1e78eb1dce5683204fdf978aa022eb544daf8e2df3acd49f7d40546e21913e81857ccae2dcd2c04b13c4fea2675923a6fadff3aa0f9fdf623f47ac24280ae62d07357e9d3d1e226a4a9facf845"},
    {"channel": 1, "timestamp": 1556747882420576, "encoded": "b45cfa5e17b7e3811919d7c12cb50286446c8677093aaf31b59a502d8738932e63d9c4c4d1f94dcabbab8338a2bac2808d9cc42fe884b5592bf92f4a06df5027f11dcc91b24d5e464743ed1562d1740a6eac270ec495bf0838bb87562e170b0b"},
    {"channel": 1, "timestamp": 1556747882922346, "encoded": "cc1e20497bfbe0974b33612762419adc33352ca7bd766696a046a89d3522349a5a131c1b2af14f0bb7f3ec8549f31075469ea97c822ab5b8a38d6bbaae0ddf87928ae774d57bcaeee7d7b009b29519da32f5d7b8c8d71fc88ab7c91b4b580e15"},
    {"channel": 1, "timestamp": 1556747883423321, "encoded": "5761f79f5037e38b37fbde4c1562af75920ed7f0247a5b7d63057008716926d68d79f9d528e20e91143e978fc95a953617d7288d4343e9e523d12d4a67094585aab1c024aded6f1de3e2f7c71f50176f905cfdf624fd19d8314c5f9f4c09aaf9"},
    {"channel": 1, "timestamp": 1556747883924077, "encoded": "c3f712f2bf16c879a833ceb4f377ec4ab8aa40b6364eb979427e82ce687ba90be7b738e08905025cd38f743cad450c74af3fbfd7481fb40ede72c63c3df2dabef8a533abf3156a397157cb98151ab5ec55353757f8f390e1f24e23ada1186a9d"},
    {"channel": 1, "timestamp": 1556747884424790, "encoded": "37ae7d94bcf6cd4a8eab5847b5a238ea90a1027e1ecd5a4c48b4c0211153525d4603a34ba42ab513ca0a487fd737ff84dc6669355734e93da5710664077a5097655b748dc4fc6d94fc704bd1c019cc7e315008a62e4b86fbdcf69de66faa97b4"},
    {"channel": 1, "timestamp": 1556747884926546, "encoded": "e06760f2246fb47cb989c1aa4601c0f910cabaf9f1ce64b35d7ff18ed0029c296be02566f885ed66d8a940785d31e3bf30c7e83cb60a59490ae466f41e797f999ac345c7260f622692e1d56ab4b4151091cf4823738c10bc3bfafff4f5c576a6"}
]

inner_pair = {"ct": bytes.fromhex("aa5ce39475c6a31519cfc1575e9e708b"),
              "pt": bytes.fromhex("808b9922ecb697d3163d8f919c06527e")}


def conn():
    r = DecoderIntf('/dev/ttyACM0')

    return r


def read_if_exists(name):
    try:
        with open(name, 'rb') as f:
            return f.read()
    except:
        return None


def xor(a, b):
    return bytes(m ^ n for m, n in zip(a, b))


def main():
    r = conn()

    frame_counter = 0
    # frame haders used for querying processor, need to do them in order to avoid timestamp issue
    frame_headers = [bytes.fromhex(frame["encoded"])[:32]
                     for frame in recorded]

    def decrypt_body(body):
        nonlocal frame_counter
        assert len(body) % 16 == 0
        # use each header in a monotonicly increasing order
        header = frame_headers[frame_counter]
        frame_counter += 1

        padding = (64 - len(body)) * b'\0'
        frame = header + body + padding

        return r.decode(frame)

    # obtains dec(inner.ct ^ outer.pt)
    # returns it as a pair
    def oracle1(outer, inner):
        message = b'\0' * 16 + xor(inner["ct"], outer["pt"]) + outer["ct"]
        # 0 || ict ^ opt      || oct
        # ? || dec(ict ^ opt) || ict
        # ? || ?              || ipt ^ dec(ict ^ opt)

        result = decrypt_body(message)
        dec_ict_opt = xor(result[32:48], inner["pt"])

        return {"ct": xor(inner["ct"], outer["pt"]), "pt": dec_ict_opt}

    # obtains dec_inner(outer1.pt ^ outer2.ct)
    # returns it as a pair
    def oracle2(outer1, outer2):
        message = outer2["pt"] + outer2["ct"] + outer1["ct"]
        # opt2 || oct2 || oct1
        # ?    || 0    || opt1 ^ oct2
        # ?    || ?    || dec(opt1 ^ oct2)

        result = decrypt_body(message)
        return {"ct": xor(outer1["pt"], outer2["ct"]), "pt": result[32:48]}

    counter = 0
    inner_temp = inner_pair
    outer_temp = None
    for pair in pairs:
        pt, ct = bytes.fromhex(pair["pt"]), bytes.fromhex(pair["ct"])
        if counter % 2 == 0:
            outer_temp = oracle1({"pt": pt, "ct": ct}, inner_temp)
        else:
            inner_temp = oracle2({"pt": pt, "ct": ct}, outer_temp)
        counter += 1
        print(outer_temp, inner_temp)

    print(outer_temp)


if __name__ == "__main__":
    main()
