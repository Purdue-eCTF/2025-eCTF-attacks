import socket
import argparse
import json
from ectf25_attack.utils import load_frames, save_frames, Frame, filter_channel
from pwn import *


def main():
    frames = load_frames('frames.json')

    c0_frames = filter_channel(frames, 0)
    frame1 = c0_frames[0]
    frame2 = c0_frames[1]
    # frame1 = Frame(timestamp = 85, channel = 0, data = b'U\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x14fI\xcc\xd7\xc7\xf9?\xb3\xb8-`\xb3o\x05d\xad\xc4~\xf2f[s\x8e\xb0M\xbf\xb02\xea\xcfCi\xc3\xa3\x9f\x18\xe6\xe3>{O\x94\x1a\\h\xb0k\xbcb\x89]0\xcc\xa6\xe89QT\xf4\xa6\xa2\xe5\xe6\xc4\x1e\xa9\xed\xccx\xe8\x84&WU)l\xad\x1d\x1d37\xef\xde)4\xeeb\x07G[}\x0c\xb7g\xb5\xe3\x9b$\xcf\xc3@\x11\xc2\xc1\xab\xec\xf6"\x01]\\\x97\xdd\xf3j\xc5X\x1a\x8a\xc6\x82\xcf\xd70\xeev\xd5\xb3\x1f\xed\x9e*\xf1\xd1\x10\xda\xe93\xd4\xb7\x8e\x9e?\xb3\x1f\xed\x9e*\xf1\xd1\x10\xda\xe93\xd4\xb7\x8e\x9e?\xb3\x1f\xed\x9e*\xf1\xd1\x10\xda\xe93\xd4\xb7\x8e\x9e?\xb3\x1f\xed\x9e*\xf1\xd1\x10\xda\xe93\xd4\xb7\x8e\x9e?\x00\x00\x00\x00)>4\xae\x9a4;\xe3\xbc\xa21\x17>\xcd*\x906\x8d\xe2\x01%\x1c\xaf\xda\x0f\xf6\x86T\x9c\xafl\xec\xf8\xf5\xafld\xa3\xcc\xef\x0e\x8c\x86\xd16\x0c{\x7f\xc5;\xd1\xe4\xd6w\x15\x82.G\x97\xab\xe7\xce\x0e\xd7\xc3(\x01\xdd\xfc=\xd4\xd53\xb5\xde\xbfi\xaa\x8c\xaaa\x06<\xce}L\xebu\xa0cVF\x92\xf0.\x9f\xe3\xdf\x10\xa3\n\xa5\xc7v\x1b\xba\xaa\x8c\xca\x9a4xo\xe9)s\xd5}!\xe0O-\'\xdb\xb5\x0f\x8a@~\xd7\xd7\x00\x15\x8ar\xd1\xf2\x96lS\xba9\xf1\xd0\xc4\xa6\xd7\x18\xb0\xe2\xd4=\x02\xbd3\xff\xf5I.\xf2\xf4\xe0\x81\xae\xd3m\xdbc\xc2\xcbF\xda\xd6\x1eK\x81\x97\xa7y\x85b\xe7\x05\xaf\xfd\xaa\xbb\xcb\xd2`l\xe7\xff\xce\x97\xcc\xf4r\xbc\xee+\xff\xc4$\x8e\xac\x0b\x95&\xbe\x14K\xd8\xc9~\x91{<\x9c\x88\x8a\xa5\xb8xI\xeb\xc15N\xe0\xddM\xeeA`\xb6\xb3\x89\xb2B=C\xb4\xf9\xd5\xf5\x19e36\xb0\x19\x0e?I\xd5&\xc2[\xca%\xe3A\x02\xa9\x7f\xd5f\x07(]\xa9\xf9i\x8b<d\x86X\x89\x19J\x83\x0e\x1d\xf8)\xe6S+\xf3q\xff\xb8\x02}\xc9\xc3\xb8\x93\xd8\x12)\xf6\xf9\x0e\xd2\xc2]s\xf4\xc9I\x91\xb0\x9c\xa2\x9d\x9dlOc\xe40h\x17 L\xf2\xd6\x02\xbbo\xd5M\x1b')
    # frame2 = Frame(timestamp = 92, channel = 0, data = b'\\\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x14\xaa\xf1\xd1)\xd1%\xc9\xe7\xd1\x83\x98e\xf9\x1d\x1dd[c\x92\xdc%\xe4\x93;\xcb\xa9=:a\xe9&\x9a3kB36|\x9b\xb4\xba\x08\x8e\x8fYT\xaa\xe2\xf8?\xe1\\A\xbd\xda\x06T\x1eB\xad[h\xe3]D_U\xe33\x9a\xd6![\xc3\xdd\x1e\xd04\xda\xa2\xa0\x85\x1fw\xd2\xd2Z\x84\'#\x91(\x89\x8e\xff\x92\xb7\xbfS\xca\xce\\_x\x88\xefVs\x90x\xcf\xb09\xf5\x14\x9d\xbd\xd1\xd2m\xc5\xce\x1a#3\xa7\x1b:`(\x91f)\xeb,\x9c\'L:Z\x14\xba\x16:`(\x91f)\xeb,\x9c\'L:Z\x14\xba\x16:`(\x91f)\xeb,\x9c\'L:Z\x14\xba\x16:`(\x91f)\xeb,\x9c\'L:Z\x14\xba\x16\x00\x00\x00\x00\xc1\xfb\xe9H\xdc\xdb\x86\xc3\n\x082I-6\x1a\x04\xc7\x91<\xe5\xcdW\xca\xa0\x94\xfe`\xe9I\x9cF\xa9#ur\x8d\xbe\x7f\x9d\x14\x0f\xca4\x9c\x18\x06D\xba/(\x08N"\x9142ni"\x96\xc7\x87\x8aNN\xee\n\x0f\xd2pY\xe3o\x1ahY\x00N\xf0\xb8\x87\x95^\x89L\x08{\x87\xf5\x84J\xf4\x8a"\x9d\xf1\x9aYC2e\xbc0X\xf5y\xa1\x98\xaa:\xe9]\x9c\xc8\xc8\xaf5\x13\xa0\xbd\xe7va\xe1\xa4\x8f\x0e\xe2\xe1\x97\x1d_\xa8\x9ag\xcbG\xc8\x8b\x91<\x193lk\x8f\xa6 M\xe5\xcd\x9b*O7\xae\xcf$\x13\x8d\x05\xc0\x11\xc3F,\xb0-f\xcc\x11K`\n\x1f\x81dq*\xb1~\xe1\xfc\xee\xc2\xd4\xdf\x9b\x8a\xcaYq\xd0G\xf8\x1b\xbe\xb0\xc0\xfe\xe5)\xe3\x0e\xe7\xcb\xe6x\x19\xe2\xbfU\x92\x13\x0f\xa39\x9f\x98\xcb\xc6\xf9,\x9b/\xceb\n\x0e\xfbN\xed\x1cy$\xe7\x19{\xd1^n/\xc8,Tz\x88w\xdd\xf9\xcdp\xce \x1dh\xdb9\x9bs\x85\x90\xee\x8cu\x95\xfa\x19\xdb\xa6cnq\x10\xf0Ft\r\x1c\xc5^\xdf\xa2!\x0e\xc3(\x19%\x07\xbfB\xd3\xb0\x9d@\xd2\x7f\xd1\xa8F\x1a\x01\xb06z\xb7<\xbb\x1d9\x81\xf3\\\x89p\x9f*4\xb7;\xde\x92\x0eQ0\x8cT\xbf\n\xc49;=\x98\xad')

    timestamp = frame2.timestamp + 1
    frame1_bad = frame1.with_data(p64(timestamp) + frame1.data[8:])

    out = [frame2, frame1_bad]
    # out = c0_frames

    save_frames('pesky_frames.json', out)

if __name__ == '__main__':
    main()
