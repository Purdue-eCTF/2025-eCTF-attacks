import socket
import argparse
import json

def main():
    parser = argparse.ArgumentParser(
        prog = 'eCTF Packet Capture Merger',
        description = 'Captures Packets Coming from the Satelite',
    )

    parser.add_argument('--out-packets', help = 'File to Save Packets In', required = True)
    parser.add_argument('in_packets', help = 'File to Load Initial Packets From', nargs = argparse.REMAINDER)

    args = parser.parse_args()

    packets = {}
    for in_file in args.in_packets:
        with open(in_file, 'r') as f:
            for packet in json.loads(f.read()):
                packets[packet['timestamp']] = packet

    packets = list(packets.values())
    packets.sort(key = lambda a: a['timestamp'])
    print(f'Merged {len(packets)} packets')

    with open(args.out_packets, 'w') as f:
        f.write(json.dumps(packets))

if __name__ == '__main__':
    main()
